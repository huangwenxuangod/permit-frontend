# 一照通前端开发需求与流程（V1）

## 页面结构与路由
- 规格搜索页：搜索框、分类筛选（全部/寸照/回执/签证/考试）、规格卡片网格（名称、像素尺寸、合回执）
- 拍摄指引页：拍摄要求图文、规格详情（冲印尺寸/像素/DPI），入口按钮“相册选取/现在拍摄”
- 检测进度页：处理状态与预计耗时、校验项（取景/姿势、光线/清晰度、表情/着装、画质优化）
- 相片预览页：单张预览，工具栏“背景（白/蓝/红）/美颜/增强/换装（预留）”，进入“下一步”
- 排版预览页（可选）：模板选择与预览（两寸版式等）
- 订单确认页（最后一步）：商品组合、办理城市（必填）、备注、价格与合计、立即支付

## 端到端流程（前端）
- 加载规格：GET /api/specs → 展示网格与筛选
- 选择图片：相册/拍摄 → Taro.uploadFile /api/upload → objectKey
- 创建任务：POST /api/tasks（specCode/objectKey/colors/widthPx/heightPx/dpi）→ processedUrls
- 预览与编辑：切换背景即时刷新；预留美颜/增强/换装入口
- 订单确认：POST /api/orders（taskId/items/city/remark/amountCents/channel）→ orderId
- 下单支付：POST /api/pay/wechat 或 /api/pay/douyin → payParams → 调用端内支付
- 回调与交付：支付回调更新订单状态；下载（开发直链 /assets，生产签名下载预留）

## 关键交互与校验
- 图片选择：本地预检查文件大小/分辨率/EXIF 旋转；失败提示与重试
- 任务处理：进度页展示预计耗时与校验项；失败解析 error.message
- 订单确认：
  - 商品组合示例：“照片回执+电子照”“排版照 x1”
  - 办理城市：必填；备注：可选
  - 价格：原价/优惠价/最终合计；“交易保障”标签展示
  - 行为：立即支付；失败重试与错误高亮
- 支付：生成 Idempotency-Key；非 2xx 统一错误体解析

## 数据模型与字段（前端使用）
- Spec：{ code, name, widthPx, heightPx, dpi, bgColors }
- UploadResp：{ objectKey }
- Task：{ id, status, processedUrls, createdAt, updatedAt }
- Order：{ orderId, taskId, items:[{type:'electronic'|'layout'|'receipt', qty}], city, remark, amountCents, channel, status }
- PayParams：渠道参数（appId/nonceStr/timeStamp/signType/paySign 等）

## 非功能与体验
- 性能：同步处理典型图 ≤ 3s；进度页骨架或动画
- 触控：按钮与卡片触达 ≥ 44x44；加载态禁用按钮
- 可访问性：对比度与焦点态；错误消息明确
- 国际化：错误 message 中文或由 code 映射

## 环境与配置
- TARO_APP_ID：小程序 AppID
- API_BASE_URL：H5 调试代理或直连地址
- 小程序白名单：API/上传/下载域名配置

## 验收标准（前端）
- 完成页面链路：规格 → 指引 → 进度 → 预览 → 排版（可选）→ 订单确认 → 支付 → 下载
- 相片预览可切换背景；订单确认包含城市/备注/合计与支付
- 错误体解析与重试；支付成功状态更新

## 对齐说明
- 与后端文档一致：端点、字段与错误体统一
- 参考：[API对接文档_V1.md](file:///d:/dev/one-permit/permit-backend/API对接文档_V1.md)

## ASCII 页面结构

### 规格搜索页
```
+---------------------------------------------------------------+
| < 返回                搜索                        ...     ○   |
+---------------------------------------------------------------+
| [ 请输入规格关键词... ]                  [ 搜索 ]             |
+---------------------------------------------------------------+
|  全部 [✓]   寸照    回执    签证    考试                      |
+---------------------------------------------------------------+
| [ 居住证  358x441px   合回执   电子照 ]  [ 社保证 358x441px ] |
| [ 一寸    295x413px   电子照 ]            [ 二寸   413x579px ]|
| [ 小二寸  413x531px ]                    [ 大一寸 390x567px ] |
| [ 小一寸  260x378px ]                    [ 驾驶证 260x378px ] |
+---------------------------------------------------------------+
```

### 拍摄指引页
```
+---------------------------------------------------------------+
| < 返回                拍摄指引                     ...     ○  |
+---------------------------------------------------------------+
| 港澳通行证   [认证回执]                                        |
|                                                           ✎   |
| 1 纯色背景与均匀光线   2 正对镜头头不倾斜   3 避免反光           |
| [ 示意图区域：三点说明配图 ]                                   |
+---------------------------------------------------------------+
| 冲印尺寸：33x48mm   像素尺寸：390x567px   分辨率：300DPI      |
+---------------------------------------------------------------+
| [ 相册选取 ]                                   [ 现在拍摄 ]    |
+---------------------------------------------------------------+
```

### 检测进度页
```
+---------------------------------------------------------------+
| < 返回                检测相片                     ...     ○  |
+---------------------------------------------------------------+
| 证件照生成中，预计耗时 ~ 5 秒                                   |
| [███████........]  进度条                                      |
| ✓ 人像取景范围/头肩姿势符合标准                                 |
| ✓ 光线、色彩、清晰度                                            |
| ✓ 表情与着装符合证件要求                                        |
| ⟳ 优化照片画质                                                  |
+---------------------------------------------------------------+
| [ 取消 ]                                        [ 重试 ]       |
+---------------------------------------------------------------+
```

### 相片预览页（单张）
```
+---------------------------------------------------------------+
| < 返回                 相片预览                     ...    ○  |
+---------------------------------------------------------------+
|  单张照预览   |   排版照预览                                     |
+---------------------------------------------------------------+
|  +-------------------------------------------+                 |
|  |                预览图（蓝底）             |                 |
|  +-------------------------------------------+                 |
+---------------------------------------------------------------+
| 背景： [ 白 ]   [ 蓝 ✓ ]   [ 红 ]                                |
| 工具： [ 换装 ]   [ 美颜 ]   [ 增强 ]                            |
|                                               [ 下一步 ]        |
+---------------------------------------------------------------+
```

### 排版预览页
```
+---------------------------------------------------------------+
| < 返回               排版照预览                     ...    ○   |
+---------------------------------------------------------------+
| 模板： [ 两寸×1 ] [ 两寸×2 ] [ 证件排版 ]                       |
+---------------------------------------------------------------+
| +---------------------------------------------+                |
| | 版式预览（裁切边距/留白/标注）               |                |
| +---------------------------------------------+                |
+---------------------------------------------------------------+
|                                               [ 下一步 ]       |
+---------------------------------------------------------------+
```

### 订单确认页（最后一步）
```
+---------------------------------------------------------------+
| < 返回               订单确认                       ...    ○   |
+---------------------------------------------------------------+
| [ 缩略图：单张 ]   [ 缩略图：排版 ]                              |
| 商品：照片回执 + 电子照     排版照 ×1                           |
| 价格：￥35.00    优惠：￥10.00    合计：￥25.00                  |
| 办理城市： [ 请选择办理城市 ]                                    |
| 备注：     [ 请输入备注 ]                                        |
| 交易保障： ✓ 官方认证回执   ✓ 在线指导                           |
+---------------------------------------------------------------+
| 合计：￥25.00                                   [ 立即支付 ]    |
+---------------------------------------------------------------+
```

### 支付结果页（成功/失败）
```
+---------------------------------------------------------------+
| < 返回               支付结果                       ...    ○   |
+---------------------------------------------------------------+
| 状态： [ 支付成功 ✓ ]   订单号：#2026-000001                    |
| 操作： [ 下载电子照 ]   [ 查看回执办理 ]                         |
| 提示： 若未自动保存，可在“我的订单”中再次下载                   |
+---------------------------------------------------------------+
|                     [ 返回首页 ]                                |
+---------------------------------------------------------------+
```

### 首页（全局入口）
文字说明
- 顶部宣传与认可标识（官方/机构认证），引导卡片区域（制作证件照、修复老照片、回执专区等）
- 功能入口宫格（智能清晰、换底色、改文件大小等）
- 热门证照规格列表（带“合回执”标签、像素说明），点击进入规格搜索/拍摄指引
- 全局悬浮客服入口与底部 TabBar（首页/订单/我的）

ASCII
```
+---------------------------------------------------------------+
| 官方 机构认可✓                    [ 轮播/宣传图 ]              |
+---------------------------------------------------------------+
| [ 制作证件照 ]   [ 修复老照片 ]   [ 回执专区 ]                 |
| [ 智能清晰 ]     [ 换底色 ]       [ 改文件大小 ]               |
+---------------------------------------------------------------+
| HOT 热门证照规格                                 [ 更多规格 ]  |
| [ 港澳通行证 390x567px 合回执 电子照 ]                         |
| [ 身份证      358x441px 合回执 电子照 ]                        |
| [ 护照        390x567px 合回执 电子照 ]                        |
| [ 社保证      358x441px 合回执 电子照 ]                        |
| [ 驾驶证      260x378px  电子照 ]                              |
| [ 保安证      358x441px  电子照 ]                              |
+---------------------------------------------------------------+
| TabBar:  [ 首页 ]   [ 订单 ]   [ 我的 ]                        |
| 悬浮客服按钮                                              ○   |
+---------------------------------------------------------------+
```

### 订单列表页
文字说明
- 顶部提示（如“系统只保留近90天订单”）
- 列表项包含缩略图、规格名称与标签（认证回执）、尺寸信息、价格与订单状态
- 点击进入订单详情（后续可扩展），支持滚动加载与空状态

ASCII
```
+---------------------------------------------------------------+
| 订单列表表                                      ...        ○  |
+---------------------------------------------------------------+
| ⚠ 系统只保留近90天的订单，请在订单完成后及时保存               |
+---------------------------------------------------------------+
| [ 缩略图 ]  护照   [ 认证回执 ]                               |
|             冲印尺寸：33x48mm   像素尺寸：390x567px           |
|                                             ￥25.00   已完成  |
+---------------------------------------------------------------+
| [ 缩略图 ]  港澳通行证 [ 认证回执 ]                           |
|             冲印尺寸：33x48mm   像素尺寸：390x567px           |
|                                             ￥25.00   待支付  |
+---------------------------------------------------------------+
| TabBar:  [ 首页 ]   [ 订单✓ ]   [ 我的 ]                       |
+---------------------------------------------------------------+
```

### 我的页
文字说明
- 用户信息：头像、昵称与 ID，编辑入口
- 快捷入口：拍照记录、设置、分享给好友、常见问题
- 底部 TabBar 与悬浮客服入口

ASCII
```
+---------------------------------------------------------------+
| 我的                                            ...       ○   |
+---------------------------------------------------------------+
| [ 头像 ]  未设置昵称                                  ✎       |
| ID：1764471719                                                 |
+---------------------------------------------------------------+
| [ 拍照记录 ]                                                   |
| [ 设置     ]                                                   |
| [ 分享给好友 ]                                                 |
| [ 常见问题 ]                                                   |
+---------------------------------------------------------------+
| TabBar:  [ 首页 ]   [ 订单 ]   [ 我的✓ ]                       |
| 悬浮客服按钮                                              ○   |
+---------------------------------------------------------------+
```
